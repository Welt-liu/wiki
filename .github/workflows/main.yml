# .github/workflows/deploy.yml

# 工作流的名称，会显示在 GitHub 仓库的 Actions 页面
name: Build and Deploy MkDocs

# 触发工作流的条件：当有 push 事件发生在 main 分支时
# 如果你使用的是 master 分支，请将 main 改为 master
on:
  push:
    branches:
      - main

# 定义一个或多个任务（jobs）
jobs:
  # 任务的 ID，可以自定义
  build-and-deploy:
    # 任务运行的环境 (操作系统)
    runs-on: ubuntu-latest

    # 任务的步骤（steps）
    steps:
      # 步骤 1: 检出（checkout）你的仓库代码到 runner
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          # 如果你的文档有子模块，需要设置为 true
          submodules: true
          # 拉取所有历史，以便 last-updated 插件等能正常工作
          fetch-depth: 0

      # 步骤 2: 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # 你可以根据需要更改 Python 版本

      # 步骤 3: 安装 MkDocs 及其依赖
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          # 安装 MkDocs 和 Material 主题
          pip install mkdocs-material

      # 步骤 4: 构建 MkDocs 网站
      # 这会在仓库根目录下生成一个 'site' 文件夹，包含所有 HTML/CSS/JS 文件
      - name: Build MkDocs Site
        run: mkdocs build

      # 步骤 5: 部署到 GitHub Pages
      # 使用一个广受欢迎的第三方 Action 来处理部署
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # 部署的源目录，即 MkDocs 构建后的输出目录
          publish_dir: ./site
          # 使用 GitHub 自动生成的令牌进行认证，无需手动创建
          github_token: ${{ secrets.GITHUB_TOKEN }}
